<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amigo Secreto - Lista</title>
<style>
body { text-align:center; font-family:"Noto Sans JP",sans-serif; background:#fffaf5; color:#333; }
h1 { margin-top:1.2em; color:#e44; }
ul { list-style:none; padding:0; max-width:500px; margin:0 auto; }
li { background:white; border-radius:12px; margin:8px 0; padding:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
a { text-decoration:none; color:#e44; font-weight:bold; }
a:hover { text-decoration:underline; }
form { margin:20px auto; max-width:400px; display:flex; justify-content:center; gap:10px; }
input { flex:1; padding:8px; border-radius:6px; border:1px solid #aaa; }
button { background:#e44; color:white; border:none; border-radius:6px; padding:8px 16px; cursor:pointer; }
button:hover { background:#c22; }
</style>
</head>
<body>
<h1>üéÅ Lista de Links do Amigo Secreto üéÅ</h1>
<form id="addForm">
<input type="text" id="nameInput" placeholder="Insira o nome" required>
<button type="submit">Adicionar</button>
</form>
<ul id="list"></ul>
<form id="resetForm">
  <input type="password" id="resetPw" placeholder="Senha para resetar">
  <button type="submit" style="background:#555;">Resetar</button>
</form>

<script>
document.getElementById("resetForm").addEventListener("submit", async e => {
	e.preventDefault();
	const pw = document.getElementById("resetPw").value;
	if(!pw) return alert("senha");
	if(!confirm("Deseja realmente resetar todos os participantes?")) return;

	const res = await fetch("/api/reset", { 
		method:"POST",
		headers: { "Content-Type":"application/json" },
		body: JSON.stringify({ password: pw })
	});

	const text = await res.text();
	if(!res.ok){
		alert("Falha ao resetar: " + text);
		return;
	}

	alert(text);
	document.getElementById("resetPw").value = "";
	await loadList();
});
</script>

<script>
async function loadList() {
	const res = await fetch("/api/list");
	const data = await res.json();
	const ul = document.getElementById("list");
	ul.innerHTML = '';
	if (data.length === 0) {
		ul.innerHTML = '<li>Nenhum participante ainda.</li>';
		return;
	}
	data.forEach(p => {
		const li = document.createElement('li');
		li.innerHTML = `${p.name} ‚Üí <a href="${p.link}" target="_blank">Ver resultado</a>`;
		ul.appendChild(li);
	});
}
document.getElementById("addForm").addEventListener("submit", async e => {
	e.preventDefault();
	const name = document.getElementById("nameInput").value.trim();
	if (!name) return alert("insira o nome");
	const res = await fetch("/api/add", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ name }) });
	if (!res.ok) {
		const text = await res.text();
		alert("Falha ao adicionar: " + text);
		return;
	}
	document.getElementById("nameInput").value = "";
	await loadList();
});
loadList();
</script>
</body>
</html>
